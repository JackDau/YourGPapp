<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feedback - Your GP</title>
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    .feedback-container {
      padding: var(--space-4);
      min-height: calc(100vh - 180px);
      display: flex;
      flex-direction: column;
    }

    .feedback-header {
      text-align: center;
      padding: var(--space-4) 0 var(--space-5);
    }

    .doctor-avatar-large {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: white;
      margin: 0 auto var(--space-4);
    }

    .feedback-title {
      font-size: var(--font-size-xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-2);
    }

    .feedback-subtitle {
      color: var(--color-gray-500);
      font-size: var(--font-size-sm);
    }

    .rating-section {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: var(--space-5);
      margin-bottom: var(--space-4);
      text-align: center;
    }

    .rating-label {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-4);
    }

    .star-rating {
      display: flex;
      justify-content: center;
      gap: var(--space-2);
      margin-bottom: var(--space-3);
    }

    .star {
      width: 48px;
      height: 48px;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .star svg {
      width: 100%;
      height: 100%;
      fill: var(--color-gray-200);
      stroke: var(--color-gray-300);
      stroke-width: 1;
      transition: all var(--transition-fast);
    }

    .star:hover svg,
    .star.active svg {
      fill: #fbbf24;
      stroke: #f59e0b;
    }

    .star:hover {
      transform: scale(1.1);
    }

    .rating-text {
      font-size: var(--font-size-sm);
      color: var(--color-gray-500);
      min-height: 20px;
    }

    .feedback-questions {
      margin-bottom: var(--space-4);
    }

    .feedback-question {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: var(--space-4);
      margin-bottom: var(--space-3);
    }

    .question-text {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-3);
      font-size: var(--font-size-sm);
    }

    .quick-options {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-2);
    }

    .quick-option {
      padding: var(--space-2) var(--space-3);
      background: var(--color-gray-100);
      border: 1px solid var(--color-gray-200);
      border-radius: var(--radius-full);
      font-size: var(--font-size-sm);
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .quick-option:hover {
      background: var(--color-gray-200);
    }

    .quick-option.selected {
      background: var(--color-primary);
      border-color: var(--color-primary);
      color: white;
    }

    .comment-section {
      background: var(--color-white);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      padding: var(--space-4);
      margin-bottom: var(--space-5);
    }

    .comment-label {
      font-weight: var(--font-weight-medium);
      margin-bottom: var(--space-3);
      font-size: var(--font-size-sm);
    }

    .comment-textarea {
      width: 100%;
      min-height: 100px;
      padding: var(--space-3);
      border: 1px solid var(--color-gray-200);
      border-radius: var(--radius-md);
      font-family: inherit;
      font-size: var(--font-size-base);
      resize: vertical;
      transition: border-color var(--transition-fast);
    }

    .comment-textarea:focus {
      outline: none;
      border-color: var(--color-primary);
    }

    .comment-textarea::placeholder {
      color: var(--color-gray-400);
    }

    .actions {
      margin-top: auto;
      padding-top: var(--space-4);
    }

    .btn-submit {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-2);
      width: 100%;
      padding: var(--space-4);
      background: var(--color-primary);
      border: none;
      border-radius: var(--radius-lg);
      font-size: var(--font-size-base);
      font-weight: var(--font-weight-semibold);
      color: white;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .btn-submit:hover {
      background: var(--color-primary-hover);
    }

    .btn-submit svg {
      width: 20px;
      height: 20px;
    }

    .skip-link {
      display: block;
      text-align: center;
      margin-top: var(--space-3);
      color: var(--color-gray-500);
      font-size: var(--font-size-sm);
      text-decoration: none;
    }

    .skip-link:hover {
      color: var(--color-gray-700);
    }

    /* Thank you state */
    .thank-you-container {
      display: none;
      text-align: center;
      padding: var(--space-8) var(--space-4);
    }

    .thank-you-container.show {
      display: block;
    }

    .feedback-form {
      display: block;
    }

    .feedback-form.hidden {
      display: none;
    }

    .thank-you-icon {
      width: 80px;
      height: 80px;
      background: var(--color-success);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-5);
      animation: pop-in 0.4s ease-out;
    }

    @keyframes pop-in {
      0% { transform: scale(0); opacity: 0; }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    .thank-you-icon svg {
      width: 40px;
      height: 40px;
      stroke: white;
      stroke-width: 3;
    }

    .thank-you-title {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      margin-bottom: var(--space-2);
    }

    .thank-you-message {
      color: var(--color-gray-500);
      margin-bottom: var(--space-6);
      line-height: 1.6;
    }

    .payment-receipt {
      background: var(--color-gray-50);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      margin-bottom: var(--space-5);
      text-align: left;
    }

    .receipt-row {
      display: flex;
      justify-content: space-between;
      padding: var(--space-2) 0;
      font-size: var(--font-size-sm);
    }

    .receipt-label {
      color: var(--color-gray-500);
    }

    .receipt-value {
      font-weight: var(--font-weight-medium);
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <h1 class="header-title">Feedback</h1>
      </div>
      <div class="header-right"></div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <div class="feedback-container">
        <!-- Feedback Form -->
        <div class="feedback-form" id="feedbackForm">
          <!-- Header -->
          <div class="feedback-header">
            <div class="doctor-avatar-large" id="doctorAvatar" style="background-color: #0d9488;">EC</div>
            <h1 class="feedback-title">How was your visit?</h1>
            <p class="feedback-subtitle">Your feedback helps us improve</p>
          </div>

          <!-- Star Rating -->
          <div class="rating-section">
            <div class="rating-label">Rate your consultation with <span id="doctorName">Dr. Emily Chen</span></div>
            <div class="star-rating" id="starRating">
              <div class="star" data-rating="1" onclick="setRating(1)">
                <svg viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
              <div class="star" data-rating="2" onclick="setRating(2)">
                <svg viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
              <div class="star" data-rating="3" onclick="setRating(3)">
                <svg viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
              <div class="star" data-rating="4" onclick="setRating(4)">
                <svg viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
              <div class="star" data-rating="5" onclick="setRating(5)">
                <svg viewBox="0 0 24 24">
                  <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
              </div>
            </div>
            <div class="rating-text" id="ratingText"></div>
          </div>

          <!-- Quick Questions -->
          <div class="feedback-questions">
            <div class="feedback-question">
              <div class="question-text">What did you like about your visit?</div>
              <div class="quick-options">
                <span class="quick-option" onclick="toggleOption(this)">Easy to book</span>
                <span class="quick-option" onclick="toggleOption(this)">Short wait time</span>
                <span class="quick-option" onclick="toggleOption(this)">Clear explanation</span>
                <span class="quick-option" onclick="toggleOption(this)">Felt listened to</span>
                <span class="quick-option" onclick="toggleOption(this)">Professional</span>
                <span class="quick-option" onclick="toggleOption(this)">Video quality</span>
              </div>
            </div>

            <div class="feedback-question">
              <div class="question-text">What could be improved?</div>
              <div class="quick-options">
                <span class="quick-option" onclick="toggleOption(this)">Waiting time</span>
                <span class="quick-option" onclick="toggleOption(this)">Video quality</span>
                <span class="quick-option" onclick="toggleOption(this)">Audio quality</span>
                <span class="quick-option" onclick="toggleOption(this)">More time needed</span>
                <span class="quick-option" onclick="toggleOption(this)">Nothing</span>
              </div>
            </div>
          </div>

          <!-- Comment -->
          <div class="comment-section">
            <div class="comment-label">Anything else you'd like to share? (optional)</div>
            <textarea class="comment-textarea" id="commentText" placeholder="Tell us more about your experience..."></textarea>
          </div>

          <!-- Actions -->
          <div class="actions">
            <button type="button" class="btn-submit" onclick="submitFeedback()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="22" y1="2" x2="11" y2="13"/>
                <polygon points="22 2 15 22 11 13 2 9 22 2"/>
              </svg>
              Submit Feedback
            </button>
            <a href="video-call-ended.html" class="skip-link">Skip for now</a>
          </div>
        </div>

        <!-- Thank You State -->
        <div class="thank-you-container" id="thankYouContainer">
          <div class="thank-you-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
          <h1 class="thank-you-title">Thank You!</h1>
          <p class="thank-you-message">Your feedback helps us provide better care for all our patients.</p>

          <div class="payment-receipt">
            <div class="receipt-row">
              <span class="receipt-label">Payment</span>
              <span class="receipt-value" id="receiptAmount">$43.60</span>
            </div>
            <div class="receipt-row">
              <span class="receipt-label">Receipt sent to</span>
              <span class="receipt-value">your email</span>
            </div>
          </div>

          <a href="video-call-ended.html" class="btn btn-primary btn-block btn-lg">
            View Summary
          </a>
          <a href="dashboard.html" class="skip-link" style="margin-top: var(--space-4);">
            Return to Home
          </a>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="dashboard.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
        </span>
        <span class="nav-item-label">Home</span>
      </a>
      <a href="appointments.html" class="nav-item active">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </span>
        <span class="nav-item-label">Appointments</span>
      </a>
      <a href="requests.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="12" y1="18" x2="12" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
          </svg>
        </span>
        <span class="nav-item-label">Requests</span>
      </a>
      <a href="more.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="1"/>
            <circle cx="19" cy="12" r="1"/>
            <circle cx="5" cy="12" r="1"/>
          </svg>
        </span>
        <span class="nav-item-label">More</span>
      </a>
    </nav>
  </div>

  <script>
    let currentRating = 0;
    const ratingTexts = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];

    document.addEventListener('DOMContentLoaded', function() {
      // Get call info from session storage
      const callInfoStr = sessionStorage.getItem('yourgp_last_call');

      if (callInfoStr) {
        const callInfo = JSON.parse(callInfoStr);

        // Update doctor info
        if (callInfo.practitionerName) {
          document.getElementById('doctorName').textContent = callInfo.practitionerName;
        }
        if (callInfo.practitionerInitials) {
          document.getElementById('doctorAvatar').textContent = callInfo.practitionerInitials;
        }
        if (callInfo.practitionerColor) {
          document.getElementById('doctorAvatar').style.backgroundColor = callInfo.practitionerColor;
        }
        if (callInfo.paymentAmount) {
          document.getElementById('receiptAmount').textContent = callInfo.paymentAmount;
        }
      }
    });

    function setRating(rating) {
      currentRating = rating;

      // Update stars
      document.querySelectorAll('.star').forEach((star, index) => {
        if (index < rating) {
          star.classList.add('active');
        } else {
          star.classList.remove('active');
        }
      });

      // Update text
      document.getElementById('ratingText').textContent = ratingTexts[rating];
    }

    function toggleOption(element) {
      element.classList.toggle('selected');
    }

    function submitFeedback() {
      // Collect feedback data
      const selectedPositives = [];
      const selectedImprovements = [];

      document.querySelectorAll('.feedback-question').forEach((question, index) => {
        question.querySelectorAll('.quick-option.selected').forEach(opt => {
          if (index === 0) {
            selectedPositives.push(opt.textContent);
          } else {
            selectedImprovements.push(opt.textContent);
          }
        });
      });

      const feedback = {
        rating: currentRating,
        positives: selectedPositives,
        improvements: selectedImprovements,
        comment: document.getElementById('commentText').value
      };

      console.log('Feedback submitted:', feedback);

      // Show thank you
      document.getElementById('feedbackForm').classList.add('hidden');
      document.getElementById('thankYouContainer').classList.add('show');
    }
  </script>
</body>
</html>
