<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Your GP</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <div class="header-brand">
          <span class="header-logo">Your GP</span>
        </div>
      </div>
      <div class="header-right">
        <a href="settings.html" class="header-action">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </a>
        <div class="avatar">SJ</div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Greeting -->
      <div style="padding: var(--space-4) var(--space-4) 0;">
        <h1 style="font-size: var(--font-size-2xl);" id="greeting">Good morning, Sarah</h1>
      </div>

      <!-- Upcoming Appointment Card -->
      <div id="upcomingAppointmentContainer">
        <!-- Dynamically populated by JavaScript -->
      </div>

      <!-- Quick Actions -->
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Quick Actions</h2>
        </div>
        <div class="quick-actions">
          <a href="appointments-book-step1.html" class="feature-card">
            <span class="feature-card-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </span>
            <span class="feature-card-label">Schedule Appt</span>
          </a>
          <a href="prescriptions.html" class="feature-card">
            <span class="feature-card-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m10.5 20.5 10-10a4.95 4.95 0 1 0-7-7l-10 10a4.95 4.95 0 1 0 7 7Z"/>
                <path d="m8.5 8.5 7 7"/>
              </svg>
            </span>
            <span class="feature-card-label">Prescriptions</span>
          </a>
          <a href="video-consultation.html" class="feature-card">
            <span class="feature-card-icon">ðŸ“¹</span>
            <span class="feature-card-label">Test Video Call</span>
          </a>
          <a href="reminders.html" class="feature-card">
            <span class="feature-card-icon">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
              </svg>
            </span>
            <span class="feature-card-label">Reminders</span>
          </a>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Recent Activity</h2>
          <a href="#" class="section-action">View All</a>
        </div>
        <div class="card" style="margin: 0 var(--space-4); border-radius: var(--radius-lg); overflow: hidden;">
          <a href="test-results.html" class="list-item">
            <div class="list-item-icon icon-container-info">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <line x1="10" y1="9" x2="8" y2="9"/>
              </svg>
            </div>
            <div class="list-item-content">
              <div class="list-item-title">
                New test results available
                <span class="badge badge-info badge-dot" style="margin-left: var(--space-2); vertical-align: middle;"></span>
              </div>
              <div class="list-item-subtitle">Blood Test - 2 days ago</div>
            </div>
            <span class="list-item-arrow">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </span>
          </a>
          <a href="referral-detail.html?id=ref_1" class="list-item">
            <div class="list-item-icon icon-container-purple">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                <polyline points="14 2 14 8 20 8"/>
                <line x1="16" y1="13" x2="8" y2="13"/>
                <line x1="16" y1="17" x2="8" y2="17"/>
                <polyline points="10 9 9 9 8 9"/>
              </svg>
            </div>
            <div class="list-item-content">
              <div class="list-item-title">New referral letter</div>
              <div class="list-item-subtitle">Cardiology - 5 days ago</div>
            </div>
            <span class="list-item-arrow">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </span>
          </a>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
      <a href="dashboard.html" class="nav-item active">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
          </svg>
        </span>
        <span class="nav-item-label">Home</span>
      </a>
      <a href="appointments.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
        </span>
        <span class="nav-item-label">Appointments</span>
      </a>
      <a href="requests.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="12" y1="18" x2="12" y2="12"/>
            <line x1="9" y1="15" x2="15" y2="15"/>
          </svg>
        </span>
        <span class="nav-item-label">Requests</span>
      </a>
      <a href="more.html" class="nav-item">
        <span class="nav-item-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="1"/>
            <circle cx="19" cy="12" r="1"/>
            <circle cx="5" cy="12" r="1"/>
          </svg>
        </span>
        <span class="nav-item-label">More</span>
      </a>
    </nav>

    <!-- More Menu -->
    <div class="more-menu-backdrop" id="moreMenuBackdrop" onclick="toggleMoreMenu()"></div>
    <div class="more-menu" id="moreMenu">
      <a href="referrals.html" class="more-menu-item">
        <span class="more-menu-item-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
            <line x1="16" y1="13" x2="8" y2="13"/>
            <line x1="16" y1="17" x2="8" y2="17"/>
            <polyline points="10 9 9 9 8 9"/>
          </svg>
        </span>
        <span>Referrals</span>
      </a>
      <a href="reminders.html" class="more-menu-item">
        <span class="more-menu-item-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
            <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
          </svg>
        </span>
        <span>Reminders</span>
      </a>
      <a href="family.html" class="more-menu-item">
        <span class="more-menu-item-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </span>
        <span>Family Members</span>
      </a>
      <a href="settings.html" class="more-menu-item">
        <span class="more-menu-item-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3"/>
            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
          </svg>
        </span>
        <span>Settings</span>
      </a>
      <a href="help.html" class="more-menu-item">
        <span class="more-menu-item-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
            <line x1="12" y1="17" x2="12.01" y2="17"/>
          </svg>
        </span>
        <span>Help & Support</span>
      </a>
    </div>
  </div>

  <script src="../js/appointments.js"></script>
  <script>
    // Set greeting based on time of day
    function setGreeting() {
      const hour = new Date().getHours();
      let greeting = 'Hello';

      if (hour >= 5 && hour < 12) {
        greeting = 'Good morning';
      } else if (hour >= 12 && hour < 17) {
        greeting = 'Good afternoon';
      } else if (hour >= 17 && hour < 21) {
        greeting = 'Good evening';
      }

      document.getElementById('greeting').textContent = greeting + ', Sarah';
    }

    // Toggle more menu
    function toggleMoreMenu() {
      const menu = document.getElementById('moreMenu');
      const backdrop = document.getElementById('moreMenuBackdrop');
      menu.classList.toggle('open');
      backdrop.classList.toggle('open');
    }

    // Load upcoming appointment dynamically
    function loadUpcomingAppointment() {
      const container = document.getElementById('upcomingAppointmentContainer');
      const appointments = AppointmentsModule.getAppointments();
      const now = new Date();

      // Filter for upcoming, non-cancelled appointments
      const upcoming = appointments
        .filter(apt => new Date(apt.dateTime) > now && apt.status !== 'cancelled')
        .sort((a, b) => new Date(a.dateTime) - new Date(b.dateTime));

      if (upcoming.length === 0) {
        container.innerHTML = `
          <div class="upcoming-appointment" style="text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px; color: var(--color-primary);">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
              </svg>
            </div>
            <p style="color: #6b7280; margin-bottom: 12px;">No upcoming appointments</p>
            <a href="appointments-book-step1.html" class="btn btn-primary">Book Appointment</a>
          </div>
        `;
        return;
      }

      const appt = upcoming[0]; // Get next appointment
      const dateObj = new Date(appt.dateTime);

      // Format relative date
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const apptDate = new Date(dateObj);
      apptDate.setHours(0, 0, 0, 0);
      const diffDays = Math.ceil((apptDate - today) / (1000 * 60 * 60 * 24));

      let dateStr;
      if (diffDays === 0) {
        dateStr = 'Today';
      } else if (diffDays === 1) {
        dateStr = 'Tomorrow';
      } else {
        const options = { weekday: 'long', day: 'numeric', month: 'short' };
        dateStr = dateObj.toLocaleDateString('en-AU', options);
      }

      // Format time
      const hour24 = dateObj.getHours();
      const minutes = dateObj.getMinutes();
      const period = hour24 >= 12 ? 'PM' : 'AM';
      const hour12 = hour24 > 12 ? hour24 - 12 : (hour24 === 0 ? 12 : hour24);
      const timeStr = `${hour12}:${minutes.toString().padStart(2, '0')} ${period}`;

      const iconSvg = appt.mode === 'telehealth'
        ? `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="23 7 16 12 23 17 23 7"/>
            <rect x="1" y="5" width="15" height="14" rx="2" ry="2"/>
          </svg>`
        : `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>`;

      container.innerHTML = `
        <div class="upcoming-appointment">
          <div class="upcoming-appointment-label">
            ${iconSvg} Upcoming Appointment
          </div>
          <div class="upcoming-appointment-doctor">${appt.practitionerName}</div>
          <div class="upcoming-appointment-type">${appt.typeName}</div>
          <div class="upcoming-appointment-time">${dateStr}, ${timeStr}</div>
          <div class="upcoming-appointment-actions">
            <a href="appointment-detail.html?id=${appt.id}" class="btn">View Details</a>
            <a href="appointments-book-step3.html" class="btn">Reschedule</a>
          </div>
        </div>
      `;
    }

    // Initialize
    setGreeting();
    loadUpcomingAppointment();
  </script>
</body>
</html>
